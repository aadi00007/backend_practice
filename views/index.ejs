<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>URL Shortener</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f8f9fa; }
        .url-cell { max-width: 300px; word-wrap: break-word; }
        .short-url { color: #0d6efd; text-decoration: none; font-weight: 500; }
        .short-url:hover { text-decoration: underline; }
        .short-id { background-color: #e9ecef; color: #495057; padding: 0.25rem 0.5rem; border-radius: 0.375rem; font-size: 0.875rem; }
    </style>
</head>
<body>
    <div class="container mt-5">
        <div class="row justify-content-center">
            <div class="col-md-10">
                <h1 class="text-center mb-4">URL Shortener</h1>
                
                <!-- URL Shortening Form -->
                <div class="card mb-5">
                    <div class="card-body">
                        <h5 class="card-title">Shorten a URL</h5>
                        <form action="/url" method="POST" class="d-flex">
                            <input 
                                type="url" 
                                name="url" 
                                placeholder="Enter your long URL here..." 
                                class="form-control me-2" 
                                required
                            >
                            <button type="submit" class="btn btn-primary">Shorten</button>
                        </form>
                    </div>
                </div>

                <!-- URLs Table -->
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">
                            All Shortened URLs 
                            <% if (typeof urls !== 'undefined' && urls) { %>
                                (<%= urls.length %>)
                            <% } else { %>
                                (0)
                            <% } %>
                        </h5>
                    </div>
                    <div class="card-body p-0">
                        <% if (typeof urls !== 'undefined' && urls && urls.length > 0) { %>
                            <div class="table-responsive">
                                <table class="table table-hover mb-0">
                                    <thead class="table-dark">
                                        <tr>
                                            <th>Original URL</th>
                                            <th>Short URL</th>
                                            <th>Short ID</th>
                                            <th>Clicks</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <% urls.forEach(function(url) { %>
                                            <tr>
                                                <td class="url-cell">
                                                    <a href="<%= url.redirectURL || url.redirectUrl || '#' %>" target="_blank" 
                                                       title="<%= url.redirectURL || url.redirectUrl || 'No URL' %>">
                                                        <% 
                                                        const originalUrl = url.redirectURL || url.redirectUrl || 'No URL';
                                                        const displayUrl = originalUrl.length > 50 ? originalUrl.substring(0, 50) + '...' : originalUrl;
                                                        %>
                                                        <%= displayUrl %>
                                                    </a>
                                                </td>
                                                <td>
                                                    <a href="/<%= url.shortId || url.shortID || '' %>" 
                                                       target="_blank" class="short-url">
                                                        <% if (typeof baseUrl !== 'undefined') { %>
                                                            <%= baseUrl %>/<%= url.shortId || url.shortID || '' %>
                                                        <% } else { %>
                                                            http://localhost:8000/<%= url.shortId || url.shortID || '' %>
                                                        <% } %>
                                                    </a>
                                                </td>
                                                <td>
                                                    <code class="short-id"><%= url.shortId || url.shortID || 'N/A' %></code>
                                                </td>
                                                <td>
                                                    <span class="badge bg-info">
                                                        <%= url.clicks || url.visitHistory?.length || 0 %> clicks
                                                    </span>
                                                </td>
                                                <td>
                                                    <button class="btn btn-sm btn-outline-secondary copy-btn" 
                                                            data-url="<% if (typeof baseUrl !== 'undefined') { %><%= baseUrl %><% } else { %>http://localhost:8000<% } %>/<%= url.shortId || url.shortID || '' %>">
                                                        Copy
                                                    </button>
                                                </td>
                                            </tr>
                                        <% }); %>
                                    </tbody>
                                </table>
                            </div>
                        <% } else { %>
                            <div class="text-center py-5">
                                <h5 class="text-muted">No URLs shortened yet</h5>
                                <p class="text-muted">Create your first short URL using the form above!</p>
                            </div>
                        <% } %>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Copy to clipboard functionality
        document.querySelectorAll('.copy-btn').forEach(function(button) {
            button.addEventListener('click', function() {
                const url = this.getAttribute('data-url');
                
                // Fallback for older browsers
                if (navigator.clipboard) {
                    navigator.clipboard.writeText(url).then(function() {
                        button.textContent = 'Copied!';
                        button.classList.remove('btn-outline-secondary');
                        button.classList.add('btn-success');
                        
                        setTimeout(function() {
                            button.textContent = 'Copy';
                            button.classList.remove('btn-success');
                            button.classList.add('btn-outline-secondary');
                        }, 2000);
                    }).catch(function(err) {
                        console.error('Failed to copy: ', err);
                        fallbackCopy(url, button);
                    });
                } else {
                    fallbackCopy(url, button);
                }
            });
        });

        function fallbackCopy(text, button) {
            const textArea = document.createElement('textarea');
            textArea.value = text;
            document.body.appendChild(textArea);
            textArea.select();
            try {
                document.execCommand('copy');
                button.textContent = 'Copied!';
                button.classList.remove('btn-outline-secondary');
                button.classList.add('btn-success');
                
                setTimeout(function() {
                    button.textContent = 'Copy';
                    button.classList.remove('btn-success');
                    button.classList.add('btn-outline-secondary');
                }, 2000);
            } catch (err) {
                console.error('Fallback copy failed: ', err);
            }
            document.body.removeChild(textArea);
        }
    </script>
</body>
</html>
